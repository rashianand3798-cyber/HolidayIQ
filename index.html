<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HolidayIQ ‚Äî Plan Smarter, Travel More</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<style>
  :root {
    --ink: #0f0e0c;
    --paper: #faf8f3;
    --sand: #e8dcc8;
    --clay: #c4956a;
    --terra: #a0522d;
    --moss: #4a7c59;
    --sky: #4a90a4;
    --accent: #e85d26;
    --gold: #d4a843;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--paper);
    color: var(--ink);
    min-height: 100vh;
    overflow-x: hidden;
  }

  .hidden { display: none !important; }

  /* ‚îÄ‚îÄ‚îÄ LANDING ‚îÄ‚îÄ‚îÄ */
  #landing {
    min-height: 100vh;
    display: grid;
    grid-template-columns: 1fr 1fr;
    position: relative;
    overflow: hidden;
  }

  .landing-left {
    background: var(--ink);
    padding: 60px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    position: relative;
    overflow: hidden;
  }

  .landing-left::before {
    content: '';
    position: absolute;
    top: -100px; right: -100px;
    width: 400px; height: 400px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(200,149,106,0.15) 0%, transparent 70%);
  }

  .logo {
    font-family: 'Playfair Display', serif;
    font-size: 28px;
    font-weight: 900;
    color: var(--paper);
    letter-spacing: -0.5px;
  }

  .logo span { color: var(--clay); }

  .hero-text {
    z-index: 1;
  }

  .hero-tag {
    display: inline-block;
    background: rgba(200,149,106,0.2);
    color: var(--clay);
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 3px;
    text-transform: uppercase;
    padding: 6px 14px;
    border-radius: 20px;
    margin-bottom: 28px;
  }

  .hero-h1 {
    font-family: 'Playfair Display', serif;
    font-size: 58px;
    font-weight: 900;
    line-height: 1.05;
    color: var(--paper);
    margin-bottom: 24px;
  }

  .hero-h1 em {
    font-style: italic;
    color: var(--clay);
  }

  .hero-sub {
    font-size: 16px;
    line-height: 1.7;
    color: rgba(250,248,243,0.6);
    max-width: 380px;
  }

  .hero-stats {
    display: flex;
    gap: 40px;
    z-index: 1;
  }

  .stat { }
  .stat-num {
    font-family: 'Playfair Display', serif;
    font-size: 32px;
    font-weight: 700;
    color: var(--clay);
  }
  .stat-label {
    font-size: 12px;
    color: rgba(250,248,243,0.5);
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  .landing-right {
    background: var(--paper);
    padding: 60px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    position: relative;
  }

  .landing-right::after {
    content: '‚úà';
    position: absolute;
    bottom: 40px; right: 50px;
    font-size: 120px;
    opacity: 0.04;
    transform: rotate(-20deg);
  }

  .start-card {
    max-width: 420px;
  }

  .start-card h2 {
    font-family: 'Playfair Display', serif;
    font-size: 36px;
    font-weight: 700;
    margin-bottom: 12px;
    line-height: 1.2;
  }

  .start-card p {
    color: #666;
    font-size: 15px;
    line-height: 1.6;
    margin-bottom: 36px;
  }

  .steps-preview {
    display: flex;
    flex-direction: column;
    gap: 16px;
    margin-bottom: 36px;
  }

  .step-item {
    display: flex;
    align-items: center;
    gap: 14px;
  }

  .step-num {
    width: 32px; height: 32px;
    background: var(--ink);
    color: var(--paper);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 13px;
    font-weight: 600;
    flex-shrink: 0;
  }

  .step-text { font-size: 14px; color: #444; }

  .btn-primary {
    background: var(--accent);
    color: white;
    border: none;
    padding: 16px 36px;
    font-family: 'DM Sans', sans-serif;
    font-size: 16px;
    font-weight: 600;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 10px;
  }

  .btn-primary:hover {
    background: #c94d1e;
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(232,93,38,0.3);
  }

  .btn-secondary {
    background: transparent;
    color: var(--ink);
    border: 2px solid var(--sand);
    padding: 14px 28px;
    font-family: 'DM Sans', sans-serif;
    font-size: 15px;
    font-weight: 500;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-secondary:hover {
    border-color: var(--clay);
    color: var(--clay);
  }

  /* ‚îÄ‚îÄ‚îÄ APP SHELL ‚îÄ‚îÄ‚îÄ */
  #app {
    min-height: 100vh;
  }

  .app-header {
    background: var(--ink);
    padding: 18px 48px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .app-header .logo { font-size: 22px; }

  .header-nav {
    display: flex;
    gap: 8px;
  }

  .nav-btn {
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.12);
    color: rgba(255,255,255,0.7);
    padding: 8px 18px;
    border-radius: 6px;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    transition: all 0.2s;
  }

  .nav-btn:hover, .nav-btn.active {
    background: rgba(255,255,255,0.15);
    color: white;
  }

  /* ‚îÄ‚îÄ‚îÄ ONBOARDING ‚îÄ‚îÄ‚îÄ */
  #onboarding {
    min-height: calc(100vh - 61px);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 48px;
  }

  .onboard-wrap {
    width: 100%;
    max-width: 680px;
  }

  .progress-bar {
    display: flex;
    gap: 8px;
    margin-bottom: 48px;
  }

  .progress-seg {
    height: 4px;
    flex: 1;
    background: var(--sand);
    border-radius: 2px;
    transition: background 0.4s;
  }

  .progress-seg.active { background: var(--accent); }
  .progress-seg.done { background: var(--moss); }

  .step-label {
    font-size: 12px;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--clay);
    margin-bottom: 12px;
  }

  .step-title {
    font-family: 'Playfair Display', serif;
    font-size: 40px;
    font-weight: 700;
    line-height: 1.15;
    margin-bottom: 10px;
  }

  .step-sub {
    font-size: 16px;
    color: #666;
    margin-bottom: 36px;
    line-height: 1.6;
  }

  /* Step 1: Home city */
  .city-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 32px;
  }

  .city-btn {
    padding: 20px 16px;
    border: 2px solid var(--sand);
    border-radius: 10px;
    background: white;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
    font-family: 'DM Sans', sans-serif;
  }

  .city-btn:hover { border-color: var(--clay); }
  .city-btn.selected { border-color: var(--accent); background: #fff5f2; }

  .city-emoji { font-size: 28px; display: block; margin-bottom: 6px; }
  .city-name { font-size: 14px; font-weight: 600; }
  .city-code { font-size: 11px; color: #999; }

  /* Step 2: Upload */
  .upload-zone {
    border: 2px dashed var(--sand);
    border-radius: 14px;
    padding: 48px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    background: white;
    margin-bottom: 20px;
    position: relative;
  }

  .upload-zone:hover, .upload-zone.dragover {
    border-color: var(--clay);
    background: #fdf8f4;
  }

  .upload-zone input[type="file"] {
    position: absolute; inset: 0;
    opacity: 0; cursor: pointer; width: 100%; height: 100%;
  }

  .upload-icon { font-size: 48px; margin-bottom: 16px; }
  .upload-title { font-size: 18px; font-weight: 600; margin-bottom: 8px; }
  .upload-hint { font-size: 14px; color: #888; }

  .manual-holidays {
    margin-top: 12px;
  }

  .manual-toggle {
    background: none; border: none;
    color: var(--clay);
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    cursor: pointer;
    text-decoration: underline;
    text-underline-offset: 3px;
  }

  .holiday-input-area {
    margin-top: 16px;
  }

  .holiday-input-area textarea {
    width: 100%;
    padding: 14px;
    border: 2px solid var(--sand);
    border-radius: 8px;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    resize: vertical;
    min-height: 120px;
    outline: none;
    transition: border-color 0.2s;
  }

  .holiday-input-area textarea:focus { border-color: var(--clay); }

  .holiday-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 12px;
  }

  .holiday-tag {
    background: #e8f5ee;
    color: var(--moss);
    border-radius: 6px;
    padding: 6px 12px;
    font-size: 13px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .holiday-tag button {
    background: none; border: none;
    color: var(--moss); cursor: pointer;
    font-size: 14px; line-height: 1;
  }

  /* Step 3: Destinations */
  .dest-search-wrap {
    position: relative;
    margin-bottom: 16px;
  }

  .dest-search {
    width: 100%;
    padding: 14px 20px 14px 48px;
    border: 2px solid var(--sand);
    border-radius: 10px;
    font-family: 'DM Sans', sans-serif;
    font-size: 15px;
    outline: none;
    transition: border-color 0.2s;
    background: white;
  }

  .dest-search:focus { border-color: var(--clay); }

  .search-icon {
    position: absolute;
    left: 16px; top: 50%;
    transform: translateY(-50%);
    font-size: 18px;
    opacity: 0.4;
  }

  .dest-dropdown {
    max-height: 280px;
    overflow-y: auto;
    border: 2px solid var(--sand);
    border-radius: 10px;
    background: white;
    margin-bottom: 20px;
  }

  .dest-option {
    padding: 12px 18px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid #f0ece4;
    transition: background 0.15s;
    font-size: 14px;
  }

  .dest-option:last-child { border-bottom: none; }
  .dest-option:hover { background: #fdf8f4; }

  .dest-option.selected { background: #fff5f2; }

  .dest-badge {
    font-size: 11px;
    padding: 3px 8px;
    border-radius: 4px;
    font-weight: 500;
  }

  .badge-beach { background: #e0f0f8; color: var(--sky); }
  .badge-hills { background: #e8f5ee; color: var(--moss); }
  .badge-heritage { background: #f5f0e8; color: var(--clay); }
  .badge-nature { background: #eef5e0; color: #5a7a2a; }
  .badge-spiritual { background: #f8f0ff; color: #7a4a99; }
  .badge-adventure { background: #fff0e0; color: #b05a00; }
  .badge-urban { background: #f0f0f5; color: #4a4a7a; }
  .badge-desert { background: #fff8e0; color: #8a6a00; }

  .selected-dests {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 12px;
  }

  .dest-tag {
    background: var(--ink);
    color: var(--paper);
    border-radius: 6px;
    padding: 8px 14px;
    font-size: 13px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .dest-tag button {
    background: none; border: none;
    color: rgba(250,248,243,0.6);
    cursor: pointer; font-size: 16px; line-height: 1;
  }

  /* ‚îÄ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ‚îÄ */
  #results {
    min-height: calc(100vh - 61px);
    padding: 48px;
    max-width: 1200px;
    margin: 0 auto;
  }

  .results-header {
    margin-bottom: 40px;
  }

  .results-header h2 {
    font-family: 'Playfair Display', serif;
    font-size: 42px;
    font-weight: 700;
    margin-bottom: 8px;
  }

  .results-header p { color: #666; font-size: 16px; }

  .summary-strip {
    display: flex;
    gap: 24px;
    margin-bottom: 40px;
    padding: 24px 28px;
    background: var(--ink);
    border-radius: 14px;
    color: white;
  }

  .summary-item { }
  .summary-val {
    font-family: 'Playfair Display', serif;
    font-size: 28px;
    font-weight: 700;
    color: var(--clay);
  }
  .summary-key {
    font-size: 12px;
    color: rgba(255,255,255,0.5);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-top: 2px;
  }

  .summary-div {
    width: 1px;
    background: rgba(255,255,255,0.1);
    align-self: stretch;
  }

  .trips-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
    gap: 24px;
  }

  .trip-card {
    background: white;
    border-radius: 16px;
    overflow: hidden;
    border: 1.5px solid var(--sand);
    transition: all 0.3s;
    position: relative;
  }

  .trip-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 48px rgba(0,0,0,0.1);
  }

  .trip-card.best-pick {
    border-color: var(--accent);
  }

  .best-badge {
    position: absolute;
    top: 16px; right: 16px;
    background: var(--accent);
    color: white;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
    padding: 5px 12px;
    border-radius: 20px;
  }

  .trip-header {
    padding: 24px 24px 0;
    margin-bottom: 16px;
  }

  .trip-dest {
    font-family: 'Playfair Display', serif;
    font-size: 26px;
    font-weight: 700;
    margin-bottom: 4px;
  }

  .trip-dates {
    font-size: 13px;
    color: #888;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .trip-body { padding: 0 24px 24px; }

  .trip-pills {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 20px;
  }

  .pill {
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
  }

  .pill-leaves { background: #fff0e0; color: #b05a00; }
  .pill-weather { background: #e8f5ee; color: var(--moss); }
  .pill-type { background: #f0f0f5; color: #4a4a7a; }

  .trip-divider {
    height: 1px;
    background: var(--sand);
    margin-bottom: 20px;
  }

  .trip-section-title {
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: #aaa;
    margin-bottom: 12px;
  }

  .leaves-row {
    display: flex;
    gap: 6px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .day-chip {
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 500;
  }

  .day-holiday { background: #e8f5ee; color: var(--moss); }
  .day-weekend { background: #f0f0f5; color: #555; }
  .day-leave { background: #fff0e0; color: var(--terra); border: 1.5px dashed #c4956a; }

  .flight-box {
    background: #faf8f3;
    border-radius: 10px;
    padding: 16px;
    margin-bottom: 16px;
  }

  .flight-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
  }

  .flight-route {
    font-size: 13px;
    font-weight: 600;
  }

  .flight-price {
    font-family: 'Playfair Display', serif;
    font-size: 20px;
    font-weight: 700;
    color: var(--accent);
  }

  .flight-airline {
    font-size: 12px;
    color: #888;
  }

  .flight-meta {
    display: flex;
    gap: 12px;
  }

  .flight-meta span {
    font-size: 12px;
    color: #888;
  }

  .score-bar {
    margin-bottom: 16px;
  }

  .score-label {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: #666;
    margin-bottom: 6px;
  }

  .score-track {
    height: 6px;
    background: var(--sand);
    border-radius: 3px;
    overflow: hidden;
  }

  .score-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.8s ease;
  }

  .fill-green { background: var(--moss); }
  .fill-orange { background: var(--clay); }
  .fill-blue { background: var(--sky); }

  .trip-footer {
    padding: 16px 24px;
    background: #faf8f3;
    border-top: 1px solid var(--sand);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .total-cost {
    font-family: 'Playfair Display', serif;
    font-size: 22px;
    font-weight: 700;
  }

  .total-label { font-size: 12px; color: #888; }

  .book-btn {
    background: var(--ink);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }

  .book-btn:hover { background: var(--accent); }

  /* ‚îÄ‚îÄ‚îÄ CALENDAR VIEW ‚îÄ‚îÄ‚îÄ */
  .calendar-section {
    margin-top: 48px;
    margin-bottom: 48px;
  }

  .cal-title {
    font-family: 'Playfair Display', serif;
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 24px;
  }

  .cal-grid {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 2px;
    background: white;
    border-radius: 12px;
    padding: 24px;
    border: 1.5px solid var(--sand);
    overflow: hidden;
  }

  .cal-month {
    text-align: center;
  }

  .cal-month-name {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #888;
    margin-bottom: 8px;
  }

  .cal-dots {
    display: flex;
    flex-direction: column;
    gap: 2px;
    align-items: center;
  }

  .cal-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--sand);
  }

  .cal-dot.holiday { background: var(--moss); }
  .cal-dot.trip { background: var(--accent); }
  .cal-dot.leave { background: var(--clay); }

  .cal-legend {
    display: flex;
    gap: 20px;
    margin-top: 16px;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    color: #666;
  }

  .legend-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
  }

  /* ‚îÄ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ‚îÄ */
  #loading {
    min-height: calc(100vh - 61px);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 24px;
  }

  .loading-plane {
    font-size: 56px;
    animation: fly 2s ease-in-out infinite;
  }

  @keyframes fly {
    0%, 100% { transform: translateY(0) rotate(-5deg); }
    50% { transform: translateY(-20px) rotate(5deg); }
  }

  .loading-text {
    font-family: 'Playfair Display', serif;
    font-size: 28px;
    font-weight: 700;
  }

  .loading-steps {
    display: flex;
    flex-direction: column;
    gap: 10px;
    width: 320px;
  }

  .loading-step {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 14px;
    color: #888;
    transition: all 0.4s;
  }

  .loading-step.done { color: var(--moss); }
  .loading-step.active { color: var(--ink); font-weight: 600; }

  .l-icon { width: 20px; text-align: center; }

  .dot-loader {
    display: flex;
    gap: 6px;
    margin-top: 8px;
  }

  .dot-loader span {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--clay);
    animation: bounce 1.2s ease-in-out infinite;
  }

  .dot-loader span:nth-child(2) { animation-delay: 0.2s; }
  .dot-loader span:nth-child(3) { animation-delay: 0.4s; }

  @keyframes bounce {
    0%, 100% { transform: translateY(0); opacity: 0.4; }
    50% { transform: translateY(-8px); opacity: 1; }
  }

  /* ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ */
  .toast {
    position: fixed;
    bottom: 32px; right: 32px;
    background: var(--ink);
    color: white;
    padding: 14px 22px;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 500;
    z-index: 9999;
    animation: slideUp 0.3s ease;
  }

  @keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  /* ‚îÄ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ‚îÄ */
  @media (max-width: 900px) {
    #landing { grid-template-columns: 1fr; }
    .landing-left { min-height: 50vh; padding: 40px; }
    .hero-h1 { font-size: 42px; }
    .landing-right { padding: 40px; }
    .city-grid { grid-template-columns: repeat(2, 1fr); }
    #onboarding { padding: 24px; }
    .step-title { font-size: 30px; }
    #results { padding: 24px; }
    .cal-grid { grid-template-columns: repeat(6, 1fr); }
  }
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     LANDING PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="landing">
  <div class="landing-left">
    <div class="logo">Holiday<span>IQ</span></div>

    <div class="hero-text">
      <div class="hero-tag">‚ú® Smart Holiday Planner</div>
      <h1 class="hero-h1">
        More trips.<br>
        <em>Fewer leaves.</em>
      </h1>
      <p class="hero-sub">
        Upload your office holiday list, pick your dream destinations ‚Äî 
        we'll find the smartest long weekends with the cheapest flights.
      </p>
    </div>

    <div class="hero-stats">
      <div class="stat">
        <div class="stat-num">100+</div>
        <div class="stat-label">Indian destinations</div>
      </div>
      <div class="stat">
        <div class="stat-num">‚Çπ8‚Äì10K</div>
        <div class="stat-label">Avg flight budget</div>
      </div>
      <div class="stat">
        <div class="stat-num">4‚Äì5</div>
        <div class="stat-label">Days per trip</div>
      </div>
    </div>
  </div>

  <div class="landing-right">
    <div class="start-card">
      <h2>Plan your whole year in 3 minutes</h2>
      <p>We analyse office holidays, weekends, and your wishlist to create perfectly timed getaways.</p>

      <div class="steps-preview">
        <div class="step-item">
          <div class="step-num">1</div>
          <div class="step-text">Tell us your home city & upload office holiday PDF</div>
        </div>
        <div class="step-item">
          <div class="step-num">2</div>
          <div class="step-text">Pick up to 5 destinations from 100 curated Indian places</div>
        </div>
        <div class="step-item">
          <div class="step-num">3</div>
          <div class="step-text">Get your personalised trip calendar with flight prices</div>
        </div>
      </div>

      <button class="btn-primary" onclick="startApp()">
        Let's plan my year ‚Üí
      </button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     APP SHELL (hidden initially)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="app" class="hidden">

  <div class="app-header">
    <div class="logo">Holiday<span>IQ</span></div>
    <div class="header-nav">
      <button class="nav-btn" onclick="showSection('onboarding')">My Inputs</button>
      <button class="nav-btn" onclick="showSection('results')">My Trips</button>
    </div>
  </div>

  <!-- ONBOARDING -->
  <div id="onboarding">
    <div class="onboard-wrap">
      <div class="progress-bar">
        <div class="progress-seg active" id="seg1"></div>
        <div class="progress-seg" id="seg2"></div>
        <div class="progress-seg" id="seg3"></div>
      </div>

      <!-- STEP 1: City -->
      <div id="step1">
        <div class="step-label">Step 1 of 3</div>
        <h2 class="step-title">Where do you fly from?</h2>
        <p class="step-sub">We'll find the cheapest flights from your city.</p>

        <div class="city-grid">
          <div class="city-btn" onclick="selectCity('Mumbai','BOM')" id="city-BOM">
            <span class="city-emoji">üåä</span>
            <div class="city-name">Mumbai</div>
            <div class="city-code">BOM</div>
          </div>
          <div class="city-btn" onclick="selectCity('Delhi','DEL')" id="city-DEL">
            <span class="city-emoji">üèõÔ∏è</span>
            <div class="city-name">Delhi</div>
            <div class="city-code">DEL</div>
          </div>
          <div class="city-btn" onclick="selectCity('Bengaluru','BLR')" id="city-BLR">
            <span class="city-emoji">üåø</span>
            <div class="city-name">Bengaluru</div>
            <div class="city-code">BLR</div>
          </div>
          <div class="city-btn" onclick="selectCity('Hyderabad','HYD')" id="city-HYD">
            <span class="city-emoji">üçñ</span>
            <div class="city-name">Hyderabad</div>
            <div class="city-code">HYD</div>
          </div>
          <div class="city-btn" onclick="selectCity('Chennai','MAA')" id="city-MAA">
            <span class="city-emoji">üé≠</span>
            <div class="city-name">Chennai</div>
            <div class="city-code">MAA</div>
          </div>
          <div class="city-btn" onclick="selectCity('Kolkata','CCU')" id="city-CCU">
            <span class="city-emoji">üé®</span>
            <div class="city-name">Kolkata</div>
            <div class="city-code">CCU</div>
          </div>
        </div>

        <button class="btn-primary" onclick="goToStep(2)" id="step1-next" style="opacity:0.4;pointer-events:none">
          Continue ‚Üí
        </button>
      </div>

      <!-- STEP 2: Holidays -->
      <div id="step2" class="hidden">
        <div class="step-label">Step 2 of 3</div>
        <h2 class="step-title">Your office holidays</h2>
        <p class="step-sub">Upload your company's holiday list PDF ‚Äî or add dates manually.</p>

        <div class="upload-zone" id="uploadZone">
          <input type="file" accept=".pdf" onchange="handlePdfUpload(event)">
          <div class="upload-icon">üìÑ</div>
          <div class="upload-title">Drop your holiday PDF here</div>
          <div class="upload-hint">or click to browse ‚Äî we'll extract dates automatically</div>
        </div>

        <div id="parsedHolidays" class="holiday-tags"></div>

        <div class="manual-holidays">
          <button class="manual-toggle" onclick="toggleManual()">+ Add holidays manually instead</button>
          <div id="manualArea" class="holiday-input-area hidden">
            <p style="font-size:13px;color:#888;margin-bottom:8px">Enter dates as DD/MM or DD Month (e.g. 26 Jan, 15 Aug, 02/10)</p>
            <textarea id="manualInput" placeholder="26 Jan&#10;15 Aug&#10;02 Oct&#10;25 Dec"></textarea>
            <button class="btn-secondary" onclick="parseManual()" style="margin-top:10px;padding:10px 20px;font-size:14px">
              Add these holidays ‚úì
            </button>
          </div>
        </div>

        <div style="display:flex;gap:12px;margin-top:32px">
          <button class="btn-secondary" onclick="goToStep(1)">‚Üê Back</button>
          <button class="btn-primary" onclick="goToStep(3)" id="step2-next" style="opacity:0.4;pointer-events:none">
            Continue ‚Üí
          </button>
        </div>
      </div>

      <!-- STEP 3: Destinations -->
      <div id="step3" class="hidden">
        <div class="step-label">Step 3 of 3</div>
        <h2 class="step-title">Where do you want to go?</h2>
        <p class="step-sub">Pick up to 5 destinations. We'll match them to the best holiday pockets.</p>

        <div class="selected-dests" id="selectedDests"></div>

        <div class="dest-search-wrap">
          <span class="search-icon">üîç</span>
          <input class="dest-search" id="destSearch" type="text" placeholder="Search 100+ Indian destinations..."
            oninput="filterDests()" onfocus="showDestDropdown()">
        </div>

        <div class="dest-dropdown" id="destDropdown"></div>

        <div style="display:flex;gap:12px;margin-top:24px">
          <button class="btn-secondary" onclick="goToStep(2)">‚Üê Back</button>
          <button class="btn-primary" onclick="generateTrips()" id="step3-next" style="opacity:0.4;pointer-events:none">
            Find my perfect trips üöÄ
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- LOADING -->
  <div id="loading" class="hidden">
    <div class="loading-plane">‚úàÔ∏è</div>
    <div class="loading-text">Finding your best trips...</div>
    <div class="loading-steps">
      <div class="loading-step" id="ls1">
        <span class="l-icon">‚è≥</span> Mapping holiday pockets
      </div>
      <div class="loading-step" id="ls2">
        <span class="l-icon">‚è≥</span> Checking weather windows
      </div>
      <div class="loading-step" id="ls3">
        <span class="l-icon">‚è≥</span> Searching cheap flights
      </div>
      <div class="loading-step" id="ls4">
        <span class="l-icon">‚è≥</span> Building your trip cards
      </div>
    </div>
    <div class="dot-loader">
      <span></span><span></span><span></span>
    </div>
  </div>

  <!-- RESULTS -->
  <div id="results" class="hidden">
    <div class="results-header">
      <h2 id="resultsYear">Your perfect trips for 2026 üó∫Ô∏è</h2>
      <p id="resultsSubtitle">Based on your holidays, wishlist, and budget</p>
    </div>

    <div class="summary-strip" id="summaryStrip"></div>

    <div class="trips-grid" id="tripsGrid"></div>

    <div class="calendar-section">
      <div class="cal-title">Your year at a glance</div>
      <div class="cal-grid" id="calGrid"></div>
      <div class="cal-legend">
        <div class="legend-item"><div class="legend-dot" style="background:var(--moss)"></div> Office Holiday</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--accent)"></div> Planned Trip</div>
        <div class="legend-item"><div class="legend-dot" style="background:var(--clay)"></div> Leave Required</div>
        <div class="legend-item"><div class="legend-dot" style="background:#ddd"></div> Regular Day</div>
      </div>
    </div>

    <div style="margin-top:24px;text-align:center">
      <button class="btn-secondary" onclick="goToStep(1);showSection('onboarding')">‚Üê Change my preferences</button>
    </div>
  </div>

</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     JAVASCRIPT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// DATA: 100 Indian Destinations
// best_months: months (1-12) that are ideal to visit
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const DESTINATIONS = [
  { name: "Goa", state: "Goa", type: "beach", airport: "GOI", best_months: [11,12,1,2,3], weather_tag: "Sunny & breezy" },
  { name: "Manali", state: "HP", type: "hills", airport: "KUU", best_months: [5,6,9,10], weather_tag: "Snow-capped peaks" },
  { name: "Shimla", state: "HP", type: "hills", airport: "SLV", best_months: [3,4,5,9,10,11], weather_tag: "Cool & scenic" },
  { name: "Leh-Ladakh", state: "J&K", type: "adventure", airport: "IXL", best_months: [6,7,8,9], weather_tag: "Clear mountain skies" },
  { name: "Jaipur", state: "Rajasthan", type: "heritage", airport: "JAI", best_months: [10,11,12,1,2,3], weather_tag: "Pleasant & colourful" },
  { name: "Udaipur", state: "Rajasthan", type: "heritage", airport: "UDR", best_months: [9,10,11,12,1,2], weather_tag: "Royal & romantic" },
  { name: "Jodhpur", state: "Rajasthan", type: "heritage", airport: "JDH", best_months: [10,11,12,1,2,3], weather_tag: "Blue city charm" },
  { name: "Jaisalmer", state: "Rajasthan", type: "desert", airport: "JSA", best_months: [10,11,12,1,2,3], weather_tag: "Golden desert vibes" },
  { name: "Pushkar", state: "Rajasthan", type: "spiritual", airport: "JAI", best_months: [10,11,1,2,3], weather_tag: "Sacred & colourful" },
  { name: "Agra", state: "UP", type: "heritage", airport: "AGR", best_months: [10,11,12,1,2,3], weather_tag: "Taj in winter sun" },
  { name: "Varanasi", state: "UP", type: "spiritual", airport: "VNS", best_months: [10,11,12,1,2,3], weather_tag: "Mystical & spiritual" },
  { name: "Rishikesh", state: "Uttarakhand", type: "adventure", airport: "DED", best_months: [3,4,5,9,10,11], weather_tag: "River & mountains" },
  { name: "Haridwar", state: "Uttarakhand", type: "spiritual", airport: "DED", best_months: [3,4,5,9,10,11], weather_tag: "Holy Ganga ghats" },
  { name: "Mussoorie", state: "Uttarakhand", type: "hills", airport: "DED", best_months: [3,4,5,9,10,11], weather_tag: "Queen of hills" },
  { name: "Nainital", state: "Uttarakhand", type: "hills", airport: "PGH", best_months: [3,4,5,9,10,11], weather_tag: "Lake city escape" },
  { name: "Jim Corbett", state: "Uttarakhand", type: "nature", airport: "PGH", best_months: [11,12,1,2,3,4,5,6], weather_tag: "Tiger territory" },
  { name: "Coorg", state: "Karnataka", type: "nature", airport: "IXI", best_months: [10,11,12,1,2,3], weather_tag: "Coffee & mist" },
  { name: "Mysuru", state: "Karnataka", type: "heritage", airport: "MYQ", best_months: [9,10,11,12,1,2,3], weather_tag: "Royal & grand" },
  { name: "Hampi", state: "Karnataka", type: "heritage", airport: "HBX", best_months: [10,11,12,1,2,3], weather_tag: "Ancient ruins" },
  { name: "Chikmagalur", state: "Karnataka", type: "nature", airport: "MYQ", best_months: [9,10,11,12,1,2], weather_tag: "Coffee estates" },
  { name: "Ooty", state: "Tamil Nadu", type: "hills", airport: "CJB", best_months: [4,5,6,9,10,11,12], weather_tag: "Nilgiris coolness" },
  { name: "Kodaikanal", state: "Tamil Nadu", type: "hills", airport: "MDU", best_months: [3,4,5,9,10,11], weather_tag: "Princess of hills" },
  { name: "Mahabalipuram", state: "Tamil Nadu", type: "heritage", airport: "MAA", best_months: [10,11,12,1,2,3], weather_tag: "Shore temples" },
  { name: "Rameswaram", state: "Tamil Nadu", type: "spiritual", airport: "RMM", best_months: [10,11,12,1,2,3], weather_tag: "Sacred island" },
  { name: "Munnar", state: "Kerala", type: "nature", airport: "COK", best_months: [9,10,11,12,1,2], weather_tag: "Tea garden magic" },
  { name: "Alleppey", state: "Kerala", type: "nature", airport: "COK", best_months: [9,10,11,12,1,2], weather_tag: "Backwater bliss" },
  { name: "Varkala", state: "Kerala", type: "beach", airport: "TRV", best_months: [10,11,12,1,2,3], weather_tag: "Cliff beach" },
  { name: "Thekkady", state: "Kerala", type: "nature", airport: "COK", best_months: [9,10,11,12,1,2], weather_tag: "Periyar wildlife" },
  { name: "Kochi", state: "Kerala", type: "heritage", airport: "COK", best_months: [10,11,12,1,2,3], weather_tag: "Coastal heritage" },
  { name: "Wayanad", state: "Kerala", type: "nature", airport: "CCJ", best_months: [9,10,11,12,1,2], weather_tag: "Misty forests" },
  { name: "Darjeeling", state: "WB", type: "hills", airport: "IXB", best_months: [3,4,5,9,10,11], weather_tag: "Toy train & tea" },
  { name: "Sikkim", state: "Sikkim", type: "hills", airport: "IXB", best_months: [3,4,5,9,10,11], weather_tag: "Himalayan heaven" },
  { name: "Pelling", state: "Sikkim", type: "hills", airport: "IXB", best_months: [3,4,5,9,10], weather_tag: "Kanchenjunga views" },
  { name: "Shillong", state: "Meghalaya", type: "hills", airport: "SHL", best_months: [9,10,11,12,1,2,3,4,5], weather_tag: "Scotland of East" },
  { name: "Cherrapunji", state: "Meghalaya", type: "nature", airport: "SHL", best_months: [9,10,11,12,1,2,3], weather_tag: "Living root bridges" },
  { name: "Kaziranga", state: "Assam", type: "nature", airport: "JRH", best_months: [11,12,1,2,3,4,5], weather_tag: "One-horned rhinos" },
  { name: "Tawang", state: "Arunachal Pradesh", type: "hills", airport: "SXV", best_months: [3,4,5,9,10,11], weather_tag: "Buddhist monasteries" },
  { name: "Ziro Valley", state: "Arunachal Pradesh", type: "nature", airport: "ZER", best_months: [4,5,9,10], weather_tag: "Pine forests & tribes" },
  { name: "Spiti Valley", state: "HP", type: "adventure", airport: "KUU", best_months: [6,7,8,9], weather_tag: "Cold desert drama" },
  { name: "Dharamsala", state: "HP", type: "hills", airport: "DHM", best_months: [3,4,5,9,10,11], weather_tag: "Little Lhasa" },
  { name: "Kasol", state: "HP", type: "adventure", airport: "KUU", best_months: [5,6,9,10], weather_tag: "Parvati valley" },
  { name: "Amritsar", state: "Punjab", type: "spiritual", airport: "ATQ", best_months: [10,11,12,1,2,3], weather_tag: "Golden Temple" },
  { name: "Chandigarh", state: "Punjab", type: "urban", airport: "IXC", best_months: [10,11,12,1,2,3,4], weather_tag: "City beautiful" },
  { name: "Pondicherry", state: "TN", type: "heritage", airport: "MAA", best_months: [10,11,12,1,2,3], weather_tag: "French quarter charm" },
  { name: "Andaman Islands", state: "A&N", type: "beach", airport: "IXZ", best_months: [11,12,1,2,3,4,5], weather_tag: "Crystal blue waters" },
  { name: "Lakshadweep", state: "LD", type: "beach", airport: "AGX", best_months: [10,11,12,1,2,3,4,5], weather_tag: "Remote paradise" },
  { name: "Kovalam", state: "Kerala", type: "beach", airport: "TRV", best_months: [9,10,11,12,1,2,3], weather_tag: "Kerala beach life" },
  { name: "Tarkarli", state: "Maharashtra", type: "beach", airport: "IXE", best_months: [10,11,12,1,2,3], weather_tag: "Scuba diving" },
  { name: "Alibaug", state: "Maharashtra", type: "beach", airport: "BOM", best_months: [10,11,12,1,2,3], weather_tag: "Mumbai weekend escape" },
  { name: "Mahabaleshwar", state: "Maharashtra", type: "hills", airport: "PNQ", best_months: [9,10,11,12,1,2,3], weather_tag: "Strawberry hills" },
  { name: "Lonavala", state: "Maharashtra", type: "hills", airport: "PNQ", best_months: [6,7,8,9,10,11,12,1,2,3], weather_tag: "Monsoon magic" },
  { name: "Pune", state: "Maharashtra", type: "urban", airport: "PNQ", best_months: [10,11,12,1,2,3,4], weather_tag: "Oxford of East" },
  { name: "Aurangabad", state: "Maharashtra", type: "heritage", airport: "IXU", best_months: [10,11,12,1,2,3], weather_tag: "Ajanta & Ellora" },
  { name: "Nashik", state: "Maharashtra", type: "spiritual", airport: "ISK", best_months: [10,11,12,1,2,3], weather_tag: "Wine & divinity" },
  { name: "Panhala", state: "Maharashtra", type: "heritage", airport: "KLH", best_months: [10,11,12,1,2,3], weather_tag: "Maratha fortress" },
  { name: "Omkareshwar", state: "MP", type: "spiritual", airport: "IDR", best_months: [10,11,12,1,2,3], weather_tag: "Island temple" },
  { name: "Khajuraho", state: "MP", type: "heritage", airport: "HJR", best_months: [10,11,12,1,2,3], weather_tag: "Temple sculptures" },
  { name: "Orchha", state: "MP", type: "heritage", airport: "GWL", best_months: [10,11,12,1,2,3], weather_tag: "River & ruins" },
  { name: "Pachmarhi", state: "MP", type: "nature", airport: "BHO", best_months: [10,11,12,1,2,3,4,5], weather_tag: "Queen of Satpura" },
  { name: "Bhopal", state: "MP", type: "urban", airport: "BHO", best_months: [10,11,12,1,2,3], weather_tag: "City of lakes" },
  { name: "Puri", state: "Odisha", type: "beach", airport: "BBI", best_months: [10,11,12,1,2,3], weather_tag: "Jagannath & beach" },
  { name: "Konark", state: "Odisha", type: "heritage", airport: "BBI", best_months: [10,11,12,1,2,3], weather_tag: "Sun temple" },
  { name: "Chilika Lake", state: "Odisha", type: "nature", airport: "BBI", best_months: [11,12,1,2,3], weather_tag: "Flamingo paradise" },
  { name: "Bhubaneswar", state: "Odisha", type: "heritage", airport: "BBI", best_months: [10,11,12,1,2,3], weather_tag: "Temple city" },
  { name: "Pushkar", state: "Rajasthan", type: "spiritual", airport: "JAI", best_months: [10,11,1,2,3], weather_tag: "Camel fair magic" },
  { name: "Mount Abu", state: "Rajasthan", type: "hills", airport: "UDR", best_months: [10,11,12,1,2,3,4], weather_tag: "Only hill station" },
  { name: "Bikaner", state: "Rajasthan", type: "heritage", airport: "BKB", best_months: [10,11,12,1,2,3], weather_tag: "Desert forts" },
  { name: "Lansdowne", state: "Uttarakhand", type: "hills", airport: "IXD", best_months: [3,4,5,9,10,11], weather_tag: "Off-beat hills" },
  { name: "Chopta", state: "Uttarakhand", type: "adventure", airport: "DED", best_months: [4,5,6,9,10,11], weather_tag: "Mini Switzerland" },
  { name: "Binsar", state: "Uttarakhand", type: "nature", airport: "PGH", best_months: [3,4,5,9,10,11], weather_tag: "Wildlife sanctuary" },
  { name: "Munsiyari", state: "Uttarakhand", type: "hills", airport: "PGH", best_months: [4,5,6,9,10], weather_tag: "Little Kashmir" },
  { name: "Kausani", state: "Uttarakhand", type: "hills", airport: "PGH", best_months: [3,4,5,9,10,11], weather_tag: "Switzerland of India" },
  { name: "Mandawa", state: "Rajasthan", type: "heritage", airport: "JAI", best_months: [10,11,12,1,2,3], weather_tag: "Open art gallery" },
  { name: "Diu", state: "Diu", type: "beach", airport: "DIU", best_months: [10,11,12,1,2,3], weather_tag: "Portuguese beach town" },
  { name: "Daman", state: "Daman", type: "beach", airport: "BOM", best_months: [10,11,12,1,2,3], weather_tag: "Quiet coast" },
  { name: "Saputara", state: "Gujarat", type: "hills", airport: "STV", best_months: [6,7,8,9,10,11], weather_tag: "Gujarat hills" },
  { name: "Rann of Kutch", state: "Gujarat", type: "desert", airport: "BHJ", best_months: [11,12,1,2,3], weather_tag: "White salt desert" },
  { name: "Gir National Park", state: "Gujarat", type: "nature", airport: "DIU", best_months: [12,1,2,3,4,5], weather_tag: "Asiatic lions" },
  { name: "Dwarka", state: "Gujarat", type: "spiritual", airport: "JGA", best_months: [10,11,12,1,2,3], weather_tag: "Krishna's city" },
  { name: "Somnath", state: "Gujarat", type: "spiritual", airport: "DIU", best_months: [10,11,12,1,2,3], weather_tag: "Ancient temple" },
  { name: "Gandikota", state: "Andhra Pradesh", type: "heritage", airport: "CDP", best_months: [10,11,12,1,2,3], weather_tag: "Grand Canyon India" },
  { name: "Araku Valley", state: "Andhra Pradesh", type: "nature", airport: "VTZ", best_months: [9,10,11,12,1,2,3], weather_tag: "Tribal coffee valley" },
  { name: "Vizag", state: "Andhra Pradesh", type: "beach", airport: "VTZ", best_months: [10,11,12,1,2,3], weather_tag: "City of destiny" },
  { name: "Horsley Hills", state: "Andhra Pradesh", type: "hills", airport: "HYD", best_months: [3,4,5,9,10,11], weather_tag: "AP hill station" },
  { name: "Coonoor", state: "Tamil Nadu", type: "hills", airport: "CJB", best_months: [4,5,6,9,10,11,12], weather_tag: "Tea estate walks" },
  { name: "Yercaud", state: "Tamil Nadu", type: "hills", airport: "SXV", best_months: [3,4,5,9,10,11], weather_tag: "Shevaroy hills" },
  { name: "Valparai", state: "Tamil Nadu", type: "nature", airport: "CJB", best_months: [9,10,11,12,1,2,3], weather_tag: "Misty tea estates" },
  { name: "Tirunelveli", state: "Tamil Nadu", type: "heritage", airport: "TRZ", best_months: [10,11,12,1,2,3], weather_tag: "Sangam heritage" },
  { name: "Madurai", state: "Tamil Nadu", type: "spiritual", airport: "IXM", best_months: [10,11,12,1,2,3], weather_tag: "Temple city" },
  { name: "Warangal", state: "Telangana", type: "heritage", airport: "HYD", best_months: [10,11,12,1,2,3], weather_tag: "Kakatiya dynasty" },
  { name: "Nagarhole", state: "Karnataka", type: "nature", airport: "MYQ", best_months: [9,10,11,12,1,2,3,4], weather_tag: "Kabini wildlife" },
  { name: "Kabini", state: "Karnataka", type: "nature", airport: "MYQ", best_months: [9,10,11,12,1,2,3,4], weather_tag: "Backwater safari" },
  { name: "Badami", state: "Karnataka", type: "heritage", airport: "HBX", best_months: [10,11,12,1,2,3], weather_tag: "Cave temples" },
  { name: "Belgaum", state: "Karnataka", type: "heritage", airport: "IXG", best_months: [10,11,12,1,2,3], weather_tag: "Fort city" },
  { name: "Murudeshwar", state: "Karnataka", type: "spiritual", airport: "IXE", best_months: [10,11,12,1,2,3,4], weather_tag: "Shiva by the sea" },
  { name: "Gokarna", state: "Karnataka", type: "beach", airport: "IXE", best_months: [10,11,12,1,2,3], weather_tag: "Spiritual beach town" },
];

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// STATE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let state = {
  homeCity: null,
  homeCityCode: null,
  holidays: [],      // Array of {date: Date, name: string}
  destinations: [],  // Array of dest objects
  trips: [],
};

// Load saved state
const saved = localStorage.getItem('holidayiq_state');
if (saved) { try { Object.assign(state, JSON.parse(saved)); } catch(e){} }

function saveState() {
  localStorage.setItem('holidayiq_state', JSON.stringify(state));
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// NAVIGATION
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function startApp() {
  document.getElementById('landing').classList.add('hidden');
  document.getElementById('app').classList.remove('hidden');
  showSection('onboarding');
  scrollToTop();
}

function showSection(section) {
  ['onboarding','loading','results'].forEach(s => {
    document.getElementById(s).classList.add('hidden');
  });
  document.getElementById(section).classList.remove('hidden');
  scrollToTop();
}

function goToStep(n) {
  [1,2,3].forEach(i => {
    document.getElementById('step'+i)?.classList.add('hidden');
    const seg = document.getElementById('seg'+i);
    if (seg) { seg.classList.remove('active','done'); }
  });
  document.getElementById('step'+n)?.classList.remove('hidden');
  for (let i = 1; i < n; i++) document.getElementById('seg'+i)?.classList.add('done');
  document.getElementById('seg'+n)?.classList.add('active');
  scrollToTop();
}

function scrollToTop() { window.scrollTo({ top: 0, behavior: 'smooth' }); }

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// STEP 1: City
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function selectCity(name, code) {
  state.homeCity = name;
  state.homeCityCode = code;
  document.querySelectorAll('.city-btn').forEach(b => b.classList.remove('selected'));
  document.getElementById('city-'+code)?.classList.add('selected');
  const btn = document.getElementById('step1-next');
  btn.style.opacity = '1';
  btn.style.pointerEvents = 'auto';
  saveState();
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// STEP 2: Holidays
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleManual() {
  const area = document.getElementById('manualArea');
  area.classList.toggle('hidden');
}

function handlePdfUpload(event) {
  const file = event.target.files[0];
  if (!file) return;
  document.querySelector('.upload-icon').textContent = '‚è≥';
  document.querySelector('.upload-title').textContent = 'Reading your PDF...';

  const reader = new FileReader();
  reader.onload = async function(e) {
    try {
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
      const pdf = await pdfjsLib.getDocument({ data: e.target.result }).promise;
      let text = '';
      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const content = await page.getTextContent();
        text += content.items.map(s => s.str).join(' ') + '\n';
      }
      const parsed = extractDatesFromText(text);
      if (parsed.length > 0) {
        state.holidays = parsed;
        saveState();
        renderHolidayTags();
        document.querySelector('.upload-icon').textContent = '‚úÖ';
        document.querySelector('.upload-title').textContent = `Found ${parsed.length} holidays!`;
        enableStep2Next();
      } else {
        document.querySelector('.upload-icon').textContent = '‚ö†Ô∏è';
        document.querySelector('.upload-title').textContent = 'Could not auto-detect dates';
        document.querySelector('.upload-hint').textContent = 'Please add them manually below';
        document.getElementById('manualArea').classList.remove('hidden');
      }
    } catch(err) {
      document.querySelector('.upload-icon').textContent = 'üìÑ';
      document.querySelector('.upload-title').textContent = 'Could not read PDF';
      document.querySelector('.upload-hint').textContent = 'Please add holidays manually below';
      document.getElementById('manualArea').classList.remove('hidden');
    }
  };
  reader.readAsArrayBuffer(file);
}

function extractDatesFromText(text) {
  const holidays = [];
  const currentYear = new Date().getFullYear();
  const monthNames = ['jan','feb','mar','apr','may','jun','jul','aug','sep','oct','nov','dec',
    'january','february','march','april','may','june','july','august','september','october','november','december'];

  // Pattern: DD Month or DD/MM or Month DD
  const patterns = [
    /(\d{1,2})[-\/]?(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)[a-z]*[-\/]?(\d{4})?/gi,
    /(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)[a-z]*[-\/]?(\d{1,2})[,\-\/]?(\d{4})?/gi,
    /(\d{2})[\/\-](\d{2})[\/\-]?(\d{4})?/g,
  ];

  const seen = new Set();
  patterns.forEach(pattern => {
    let match;
    while ((match = pattern.exec(text)) !== null) {
      try {
        let day, month, year = currentYear;
        if (match[0].match(/[a-z]/i)) {
          const mStr = (match[1].match(/[a-z]/i) ? match[1] : match[2]).toLowerCase().slice(0,3);
          day = parseInt(match[1].match(/\d/) ? match[1] : match[2]);
          month = ['jan','feb','mar','apr','may','jun','jul','aug','sep','oct','nov','dec'].indexOf(mStr);
          if (match[3]) year = parseInt(match[3]);
        } else {
          day = parseInt(match[1]); month = parseInt(match[2]) - 1;
          if (match[3]) year = parseInt(match[3]);
        }
        if (day >= 1 && day <= 31 && month >= 0 && month <= 11) {
          const d = new Date(year, month, day);
          const key = d.toDateString();
          if (!seen.has(key)) {
            seen.add(key);
            holidays.push({ date: d.toISOString(), name: 'Holiday' });
          }
        }
      } catch(e) {}
    }
  });
  return holidays.sort((a,b) => new Date(a.date) - new Date(b.date));
}

function loadFallbackHolidays() {
  // 2025 Indian national holidays as default
  const defaults = [
    { date: new Date(2025, 0, 26).toISOString(), name: 'Republic Day' },
    { date: new Date(2025, 2, 14).toISOString(), name: 'Holi' },
    { date: new Date(2025, 3, 14).toISOString(), name: 'Dr Ambedkar Jayanti' },
    { date: new Date(2025, 3, 18).toISOString(), name: 'Good Friday' },
    { date: new Date(2025, 4, 12).toISOString(), name: 'Buddha Purnima' },
    { date: new Date(2025, 7, 15).toISOString(), name: 'Independence Day' },
    { date: new Date(2025, 9, 2).toISOString(), name: 'Gandhi Jayanti' },
    { date: new Date(2025, 9, 20).toISOString(), name: 'Dussehra' },
    { date: new Date(2025, 10, 5).toISOString(), name: 'Diwali' },
    { date: new Date(2025, 10, 6).toISOString(), name: 'Diwali Holiday' },
    { date: new Date(2025, 11, 25).toISOString(), name: 'Christmas' },
  ];
  state.holidays = defaults;
  saveState();
  renderHolidayTags();
  enableStep2Next();
  showToast('üìÖ Loaded standard 2025 holidays ‚Äî edit as needed!');
}

function parseManual() {
  const text = document.getElementById('manualInput').value;
  const currentYear = new Date().getFullYear();
  const newHolidays = [];

  // Parse line by line - each line is one holiday
  const lines = text.split('\n').map(l => l.trim()).filter(l => l.length > 0);
  
  lines.forEach(line => {
    // Try "DD Mon" or "DD Month" format e.g. "26 Jan", "15 August"
    const d = new Date(line + ' ' + currentYear);
    if (!isNaN(d.getTime()) && d.getFullYear() === currentYear) {
      newHolidays.push({ 
        date: d.toISOString(), 
        name: line 
      });
    }
  });

  if (newHolidays.length === 0) {
    showToast('Could not read dates. Use format: 26 Jan or 15 August');
    return;
  }

  // Merge with existing and deduplicate by date
  state.holidays.push(...newHolidays);
  const seen = new Set();
  state.holidays = state.holidays.filter(h => {
    const d = new Date(h.date);
    const k = d.getMonth() + '-' + d.getDate();
    if (seen.has(k)) return false;
    seen.add(k); return true;
  }).sort((a,b) => new Date(a.date) - new Date(b.date));

  saveState();
  renderHolidayTags();
  enableStep2Next();
  document.getElementById('manualInput').value = '';
  showToast('Added ' + newHolidays.length + ' holidays ‚úì');
}

function removeHoliday(iso) {
  state.holidays = state.holidays.filter(h => h.date !== iso);
  saveState();
  renderHolidayTags();
  if (state.holidays.length === 0) {
    const btn = document.getElementById('step2-next');
    btn.style.opacity = '0.4';
    btn.style.pointerEvents = 'none';
  }
}

function enableStep2Next() {
  const btn = document.getElementById('step2-next');
  btn.style.opacity = '1';
  btn.style.pointerEvents = 'auto';
}

function renderHolidayTags() {
  const container = document.getElementById('parsedHolidays');
  container.innerHTML = state.holidays.map(h => {
    const d = new Date(h.date);
    const label = d.toLocaleDateString('en-IN', { day:'numeric', month:'short' });
    return `<div class="holiday-tag">
      üìÖ ${h.name} (${label})
      <button onclick="removeHoliday('${h.date}')">√ó</button>
    </div>`;
  }).join('');
  if (state.holidays.length > 0) enableStep2Next();
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// STEP 3: Destinations
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function filterDests() {
  const q = document.getElementById('destSearch').value.toLowerCase();
  showDestDropdown(q);
}

function showDestDropdown(q = '') {
  const dropdown = document.getElementById('destDropdown');
  const filtered = q.length === 0
    ? DESTINATIONS.slice(0, 30)
    : DESTINATIONS.filter(d =>
        d.name.toLowerCase().includes(q) ||
        d.state.toLowerCase().includes(q) ||
        d.type.toLowerCase().includes(q)
      );

  dropdown.innerHTML = filtered.map(d => {
    const isSelected = state.destinations.some(s => s.name === d.name);
    return `<div class="dest-option ${isSelected ? 'selected' : ''}"
      onclick="toggleDest('${d.name}')">
      <span>${d.name}, ${d.state}</span>
      <span class="dest-badge badge-${d.type}">${d.type}</span>
    </div>`;
  }).join('') || '<div style="padding:16px;color:#aaa;text-align:center">No results found</div>';
}

function toggleDest(name) {
  const dest = DESTINATIONS.find(d => d.name === name);
  const idx = state.destinations.findIndex(d => d.name === name);
  if (idx >= 0) {
    state.destinations.splice(idx, 1);
  } else {
    if (state.destinations.length >= 5) {
      showToast('Max 5 destinations! Remove one first.');
      return;
    }
    state.destinations.push(dest);
  }
  saveState();
  renderSelectedDests();
  filterDests();
  const btn = document.getElementById('step3-next');
  if (state.destinations.length > 0) {
    btn.style.opacity = '1'; btn.style.pointerEvents = 'auto';
  } else {
    btn.style.opacity = '0.4'; btn.style.pointerEvents = 'none';
  }
}

function renderSelectedDests() {
  const container = document.getElementById('selectedDests');
  container.innerHTML = state.destinations.map(d =>
    `<div class="dest-tag">
      ${d.name}
      <button onclick="toggleDest('${d.name}')">√ó</button>
    </div>`
  ).join('');
}

// State restore handled in DOMContentLoaded below

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// CORE ALGORITHM: Long Weekend Detection
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function isWeekend(date) {
  const d = date.getDay();
  return d === 0 || d === 6;
}

function isHoliday(date) {
  return state.holidays.some(h => {
    const hd = new Date(h.date);
    return hd.getDate() === date.getDate() &&
           hd.getMonth() === date.getMonth();
  });
}

function getHolidayName(date) {
  const h = state.holidays.find(h => {
    const hd = new Date(h.date);
    return hd.getDate() === date.getDate() && hd.getMonth() === date.getMonth();
  });
  return h ? h.name : null;
}

function addDays(date, n) {
  const d = new Date(date);
  d.setDate(d.getDate() + n);
  return d;
}

function findLongWeekendPockets() {
  const pockets = [];
  const year = new Date().getFullYear();
  // Minimum booking window: 14 days from today
  const today = new Date();
  const minDate = new Date(today.getTime() + 14 * 24 * 60 * 60 * 1000);

  // Look for clusters: any consecutive block of 4-5 days with max 2 leaves
  for (let month = 0; month < 12; month++) {
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    for (let day = 1; day <= daysInMonth - 3; day++) {
      const startDate = new Date(year, month, day);
      // Skip dates in the past or within 14-day booking window
      if (startDate < minDate) continue;
      // Try windows of 4 and 5 days
      [4, 5].forEach(windowSize => {
        const days = [];
        let leavesNeeded = 0;
        let hasHolidayOrWeekend = false;

        for (let i = 0; i < windowSize; i++) {
          const d = addDays(startDate, i);
          const holiday = isHoliday(d);
          const weekend = isWeekend(d);
          const isLeave = !holiday && !weekend;

          days.push({
            date: new Date(d),
            isHoliday: holiday,
            isWeekend: weekend,
            isLeave,
            label: holiday ? (getHolidayName(d) || 'Holiday') : (weekend ? 'Weekend' : 'Leave'),
          });

          if (holiday || weekend) hasHolidayOrWeekend = true;
          if (isLeave) leavesNeeded++;
        }

        // Only include: has at least 1 free day, needs at most 2 leaves
        if (hasHolidayOrWeekend && leavesNeeded <= 2 && leavesNeeded >= 0) {
          // Avoid duplicates
          const key = startDate.toDateString() + windowSize;
          if (!pockets.some(p => p.key === key)) {
            pockets.push({
              key,
              startDate: new Date(startDate),
              endDate: addDays(startDate, windowSize - 1),
              days,
              leavesNeeded,
              windowSize,
              month,
            });
          }
        }
      });
    }
  }

  // Sort by leaves needed asc, then by date
  return pockets.sort((a, b) => a.leavesNeeded - b.leavesNeeded || a.startDate - b.startDate);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// WEATHER SCORING
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getWeatherScore(dest, month) {
  // month is 0-indexed
  const m = month + 1;
  const bestMonths = dest.best_months;
  if (bestMonths.includes(m)) return 100;
  // Adjacent months get partial score
  const adjacent = bestMonths.filter(bm => Math.abs(bm - m) <= 1 || Math.abs(bm - m) >= 11);
  if (adjacent.length > 0) return 60;
  return 20;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// CONFIG ‚Äî paste your Cloudflare Worker URL here after setup
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const BACKEND_URL = 'https://holidayiq-proxy.rashi-anand3798.workers.dev';

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// MOCK FLIGHT PRICES (used when BACKEND_URL is null)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const FLIGHT_PRICES = {
  GOI: { BOM: 4200, DEL: 5800, BLR: 3800, HYD: 4500, MAA: 4800, CCU: 7200 },
  IXL: { BOM: 8500, DEL: 6200, BLR: 9500, HYD: 9200, MAA: 10200, CCU: 8800 },
  JAI: { BOM: 4800, DEL: 2800, BLR: 5500, HYD: 5200, MAA: 6200, CCU: 5800 },
  KUU: { BOM: 6800, DEL: 4500, BLR: 7800, HYD: 8200, MAA: 9000, CCU: 7500 },
  IXZ: { BOM: 7500, DEL: 8200, BLR: 7000, HYD: 7800, MAA: 6800, CCU: 8500 },
  COK: { BOM: 4200, DEL: 6500, BLR: 3200, HYD: 4500, MAA: 3800, CCU: 6800 },
  IXB: { BOM: 6800, DEL: 5500, BLR: 8200, HYD: 8500, MAA: 8800, CCU: 4200 },
  DHM: { BOM: 6500, DEL: 4200, BLR: 7500, HYD: 7800, MAA: 8500, CCU: 6200 },
  VNS: { BOM: 5200, DEL: 3500, BLR: 6500, HYD: 5800, MAA: 6500, CCU: 5200 },
  SHL: { BOM: 8200, DEL: 7500, BLR: 9200, HYD: 9500, MAA: 9800, CCU: 5800 },
  DEFAULT: { BOM: 5500, DEL: 5000, BLR: 5500, HYD: 5800, MAA: 6000, CCU: 6500 },
};

const AIRLINES = ['IndiGo', 'Air India', 'SpiceJet', 'Vistara', 'GoFirst', 'Akasa'];

function getFlightPrice(destAirport, fromCode) {
  const priceMap = FLIGHT_PRICES[destAirport] || FLIGHT_PRICES.DEFAULT;
  const base = priceMap[fromCode] || 6000;
  // Add ¬±20% variation
  const variation = (Math.random() - 0.5) * 0.4;
  return Math.round(base * (1 + variation) / 100) * 100;
}

function getFlightInfo(dest, fromCode) {
  const price = getFlightPrice(dest.airport, fromCode);
  const airline = AIRLINES[Math.floor(Math.random() * AIRLINES.length)];
  const duration = Math.floor(Math.random() * 90 + 60); // 60-150 mins
  const h = Math.floor(duration / 60);
  const m = duration % 60;
  return {
    airline,
    price,
    duration: `${h}h ${m}m`,
    return_price: Math.round(price * (0.9 + Math.random() * 0.3) / 100) * 100,
  };
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// TRIP GENERATION
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function generateTrips() {
  // Only use what the user actually entered ‚Äî no auto-filling
  if (state.holidays.length === 0) {
    showToast("‚ö†Ô∏è Please add your office holidays first");
    showSection('onboarding');
    goToStep(2);
    return;
  }

  showSection('loading');
  const steps = ['ls1','ls2','ls3','ls4'];
  const stepDone = async (i) => {
    await delay(700);
    document.getElementById(steps[i]).classList.add('active','done');
    document.querySelector('#'+steps[i]+' .l-icon').textContent = '‚úÖ';
    if (i > 0) document.getElementById(steps[i-1]).classList.remove('active');
  };

  await stepDone(0); // map pockets
  const pockets = findLongWeekendPockets();

  // Score destinations against pockets
  // Score every pocket for every destination
  // Each destination gets a UNIQUE non-overlapping pocket
  const usedDateRanges = []; // track booked date ranges

  function rangesOverlap(start1, end1, start2, end2) {
    return start1 <= end2 && end1 >= start2;
  }

  function pocketIsAvailable(pocket) {
    return !usedDateRanges.some(r =>
      rangesOverlap(pocket.startDate, pocket.endDate, r.start, r.end)
    );
  }

  const scoredDestinations = state.destinations.map(dest => {
    const ranked = pockets
      .filter(p => pocketIsAvailable(p))
      .map(p => {
        const weatherScore = getWeatherScore(dest, p.month);
        const leaveScore = Math.max(0, (3 - p.leavesNeeded) * 30);
        const totalScore = weatherScore * 0.6 + leaveScore * 0.4;
        return { ...p, weatherScore, leaveScore, totalScore };
      })
      .sort((a,b) => b.totalScore - a.totalScore);

    const bestPocket = ranked[0] || null;
    if (bestPocket) {
      usedDateRanges.push({ start: bestPocket.startDate, end: bestPocket.endDate });
    }

    return {
      ...dest,
      weatherScore: bestPocket?.weatherScore || 50,
      bestPocket,
    };
  }).filter(d => d.bestPocket);

  await stepDone(1); // weather check

  let trips = [];

  // ‚îÄ‚îÄ LIVE MODE: call Amadeus via n8n ‚Äî one call per destination ‚îÄ‚îÄ
  if (BACKEND_URL && scoredDestinations.length > 0) {
    await stepDone(2);
    const liveTrips = [];
    let liveSuccess = 0;

    for (const dest of scoredDestinations) {
      try {
        const payload = {
          origin: state.homeCityCode,
          destinations: [dest],
          pockets: [dest.bestPocket],
        };

        const res = await fetch(BACKEND_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });

        if (!res.ok) throw new Error('Backend ' + res.status);
        const data = await res.json();

        if (data.success && data.trips?.length > 0) {
          const t = data.trips[0];
          // Pick best flight: prefer morning departure (before 12:00), evening return (after 16:00)
          const bestFlight = pickBestFlight(t.flights || []);
          liveTrips.push({
            dest,
            pocket: dest.bestPocket,
            flight: {
              airline: bestFlight.outbound?.airline || 'IndiGo',
              flightNumber: bestFlight.outbound?.flightNumber || '',
              departure: bestFlight.outbound?.departure || '',
              arrival: bestFlight.outbound?.arrival || '',
              returnDeparture: bestFlight.inbound?.departure || '',
              returnArrival: bestFlight.inbound?.arrival || '',
              duration: bestFlight.outbound?.duration || '',
              stops: bestFlight.outbound?.stops || 0,
            },
            isBest: false,
            totalCost: bestFlight.totalPrice || 10000,
            dataSource: 'live',
          });
          liveSuccess++;
        }
      } catch(err) {
        console.warn('Flight search failed for ' + dest.name + ':', err.message);
        // Fall back to mock for this destination only
        const mockFlight = getFlightInfo(dest, state.homeCityCode);
        liveTrips.push({
          dest,
          pocket: dest.bestPocket,
          flight: mockFlight,
          isBest: false,
          totalCost: mockFlight.price + mockFlight.return_price,
          dataSource: 'estimated',
        });
      }
    }

    trips = liveTrips;
    if (liveSuccess > 0) {
      showToast('‚úÖ Live flight prices loaded for ' + liveSuccess + ' destinations');
    } else {
      showToast('‚ö†Ô∏è Using estimated prices ‚Äî API unavailable');
    }
  } else {
    // ‚îÄ‚îÄ MOCK MODE: frontend-only calculation ‚îÄ‚îÄ
    await stepDone(2);
    trips = buildMockTrips(scoredDestinations);
    if (!BACKEND_URL) {
      showToast('üìå Using estimated prices ‚Äî connect backend for live data');
    }
  }

  await stepDone(3);
  await delay(400);

  trips.sort((a,b) => (b.pocket?.totalScore||0) - (a.pocket?.totalScore||0));
  state.trips = trips;
  saveState();
  renderResults();
  showSection('results');
}

// Pick best flight: morning outbound (before 12:00), evening inbound (after 16:00)
// If no ideal option exists, pick cheapest
function pickBestFlight(flights) {
  if (!flights || flights.length === 0) return {};

  // Score each flight by time preference
  const scored = flights.map(f => {
    let score = 0;
    const depHour = parseInt((f.outbound?.departure || '12:00').split(':')[0]);
    const retHour = parseInt((f.inbound?.departure || '18:00').split(':')[0]);

    // Morning departure: 6am-12pm is ideal
    if (depHour >= 6 && depHour < 12) score += 3;
    else if (depHour >= 12 && depHour < 15) score += 1;

    // Evening return: 4pm-10pm is ideal
    if (retHour >= 16 && retHour <= 22) score += 3;
    else if (retHour >= 13 && retHour < 16) score += 1;

    // Price bonus: cheaper = better (normalised)
    const priceScore = Math.max(0, 3 - ((f.totalPrice - 5000) / 3000));
    score += priceScore;

    return { ...f, score };
  });

  // Return highest scored flight
  scored.sort((a, b) => b.score - a.score);
  return scored[0];
}

function buildMockTrips(scoredDestinations) {
  const trips = [];
  scoredDestinations.forEach((dest) => {
    if (!dest.bestPocket) return;
    const flight = getFlightInfo(dest, state.homeCityCode);
    trips.push({
      dest,
      pocket: dest.bestPocket,
      flight: {
        ...flight,
        departure: '08:00',
        arrival: '09:15',
        returnDeparture: '18:30',
        returnArrival: '19:45',
      },
      isBest: false,
      totalCost: flight.price + flight.return_price,
      dataSource: 'estimated',
    });
  });
  // Mark highest scoring as best
  if (trips.length > 0) {
    trips.sort((a,b) => (b.pocket?.totalScore||0) - (a.pocket?.totalScore||0));
    trips[0].isBest = true;
  }
  return trips;
}

function delay(ms) { return new Promise(r => setTimeout(r, ms)); }

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// RENDER RESULTS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderResults() {
  const totalLeaves = [...new Set(state.trips.map(t => JSON.stringify(t.pocket.days.filter(d => d.isLeave).map(d => d.date))))].length;
  const avgCost = state.trips.length
    ? Math.round(state.trips.reduce((s,t) => s + t.totalCost, 0) / state.trips.length)
    : 0;

    document.getElementById('resultsYear').textContent = 'Your perfect trips for ' + new Date().getFullYear() + ' üó∫Ô∏è';
  document.getElementById('resultsSubtitle').textContent =
    `${state.trips.length} trips planned from ${state.homeCity} ‚Ä¢ ${state.destinations.length} destinations`;

  document.getElementById('summaryStrip').innerHTML = `
    <div class="summary-item">
      <div class="summary-val">${state.trips.length}</div>
      <div class="summary-key">Trips planned</div>
    </div>
    <div class="summary-div"></div>
    <div class="summary-item">
      <div class="summary-val">${state.holidays.length}</div>
      <div class="summary-key">Office holidays</div>
    </div>
    <div class="summary-div"></div>
    <div class="summary-item">
      <div class="summary-val">‚Çπ${(avgCost/1000).toFixed(1)}K</div>
      <div class="summary-key">Avg flight cost (RT)</div>
    </div>
    <div class="summary-div"></div>
    <div class="summary-item">
      <div class="summary-val">${state.destinations.length}</div>
      <div class="summary-key">Destinations</div>
    </div>
  `;

  document.getElementById('tripsGrid').innerHTML = state.trips.map((trip, idx) => {
    const { dest, pocket, flight, isBest } = trip;
    const startStr = pocket.startDate.toLocaleDateString('en-IN', { day:'numeric', month:'short' });
    const endStr = pocket.endDate.toLocaleDateString('en-IN', { day:'numeric', month:'short' });
    const weatherScore = pocket.weatherScore;
    const leaveScore = Math.round(pocket.leaveScore);
    const overallScore = Math.round(pocket.totalScore);

    const dayChips = pocket.days.map(d => {
      const cls = d.isHoliday ? 'day-holiday' : d.isWeekend ? 'day-weekend' : 'day-leave';
      const icon = d.isHoliday ? 'üèñÔ∏è' : d.isWeekend ? '‚òÄÔ∏è' : 'üìù';
      return `<span class="day-chip ${cls}">${icon} ${d.date.toLocaleDateString('en-IN',{day:'numeric',month:'short'})} ¬∑ ${d.label}</span>`;
    }).join('');

    return `
      <div class="trip-card ${isBest ? 'best-pick' : ''}">
        ${isBest ? '<div class="best-badge">‚≠ê Best Pick</div>' : ''}
        
        <div class="trip-header">
          <div class="trip-dest">${dest.name}</div>
          <div class="trip-dates">üìÖ ${startStr} ‚Äì ${endStr} ¬∑ ${pocket.windowSize} days
            <span style="margin-left:8px;font-size:11px;padding:2px 7px;border-radius:4px;background:${trip.dataSource==='live'?'#e8f5ee':'#fff5e0'};color:${trip.dataSource==='live'?'#4a7c59':'#a06000'}">
              ${trip.dataSource==='live'?'üü¢ Live prices':'üü° Estimated'}
            </span>
          </div>
        </div>

        <div class="trip-body">
          <div class="trip-pills">
            <span class="pill pill-leaves">üóìÔ∏è ${pocket.leavesNeeded} leave${pocket.leavesNeeded !== 1 ? 's' : ''} needed</span>
            <span class="pill pill-weather">üå§Ô∏è ${dest.weather_tag}</span>
            <span class="pill pill-type">${dest.type}</span>
          </div>

          <div class="trip-divider"></div>

          <div class="trip-section-title">Your days</div>
          <div class="leaves-row">${dayChips}</div>

          <div class="trip-divider"></div>

          <div class="trip-section-title">Flights from ${state.homeCity}</div>
          <div class="flight-box">
            <div class="flight-row">
              <div>
                <div class="flight-route">${state.homeCity} ‚Üí ${dest.name}</div>
                <div class="flight-airline">
                  ${flight.airline || 'IndiGo'}
                  ${flight.departure ? '¬∑ Departs ' + flight.departure : ''}
                  ${flight.arrival ? '‚Üí Arrives ' + flight.arrival : ''}
                  ${flight.duration ? '¬∑ ' + flight.duration : ''}
                  ${flight.stops === 0 ? '¬∑ Non-stop' : '¬∑ ' + flight.stops + ' stop'}
                </div>
              </div>
              <div class="flight-price">‚Çπ${(trip.totalCost/2).toLocaleString()}</div>
            </div>
            <div class="flight-row" style="margin-top:10px">
              <div>
                <div class="flight-route">${dest.name} ‚Üí ${state.homeCity}</div>
                <div class="flight-airline">
                  ${flight.airline || 'IndiGo'}
                  ${flight.returnDeparture ? '¬∑ Departs ' + flight.returnDeparture : ''}
                  ${flight.returnArrival ? '‚Üí Arrives ' + flight.returnArrival : ''}
                </div>
              </div>
              <div class="flight-price">‚Çπ${(trip.totalCost/2).toLocaleString()}</div>
            </div>
          </div>

          <div class="score-bar">
            <div class="score-label"><span>Weather match</span><span>${weatherScore}%</span></div>
            <div class="score-track"><div class="score-fill fill-green" style="width:${weatherScore}%"></div></div>
          </div>
          <div class="score-bar">
            <div class="score-label"><span>Leave efficiency</span><span>${100 - pocket.leavesNeeded * 30}%</span></div>
            <div class="score-track"><div class="score-fill fill-orange" style="width:${100 - pocket.leavesNeeded * 30}%"></div></div>
          </div>
          <div class="score-bar">
            <div class="score-label"><span>Overall score</span><span>${overallScore}%</span></div>
            <div class="score-track"><div class="score-fill fill-blue" style="width:${overallScore}%"></div></div>
          </div>
        </div>

        <div class="trip-footer">
          <div>
            <div class="total-label">Return flights total</div>
            <div class="total-cost">‚Çπ${trip.totalCost.toLocaleString()}</div>
          </div>
          <button class="book-btn" onclick="bookFlight('${dest.airport}', '${pocket.startDate.toISOString()}', '${pocket.endDate.toISOString()}')">
            View flights ‚Üí
          </button>
        </div>
      </div>
    `;
  }).join('') || `<div style="padding:48px;text-align:center;color:#888;grid-column:1/-1">
    <div style="font-size:48px;margin-bottom:16px">üòï</div>
    <div style="font-size:18px;font-weight:600;margin-bottom:8px">No optimal trips found</div>
    <p>Try adding more holidays or selecting different destinations.</p>
  </div>`;

  renderCalendar();
}

function bookFlight(destCode, depDate, retDate) {
  const fmt = (ds) => {
    const d = new Date(ds);
    const yy = String(d.getFullYear()).slice(2);
    const mm = String(d.getMonth() + 1).padStart(2, '0');
    const dd = String(d.getDate()).padStart(2, '0');
    return yy + mm + dd;
  };
  const dep = fmt(depDate);
  const ret = fmt(retDate);
  const base = state.homeCityCode.toLowerCase();
  const dest = destCode.toLowerCase();
  const url = 'https://www.skyscanner.co.in/flights/' + base + '/' + dest + '/' + dep + '/' + ret + '/?adults=1';
  window.open(url, '_blank');
}

function renderCalendar() {
  const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  const year = new Date().getFullYear();

  // Build lookup sets using simple DD-MM keys for reliable matching
  const holidaySet = new Set();
  const tripSet = new Set();
  const leaveSet = new Set();

  // Add office holidays
  state.holidays.forEach(h => {
    const d = new Date(h.date);
    if (d.getFullYear() === year) {
      holidaySet.add(d.getMonth() + '-' + d.getDate());
    }
  });

  // Add trip days and leave days
  state.trips.forEach(t => {
    if (!t.pocket || !t.pocket.days) return;
    t.pocket.days.forEach(dayObj => {
      const d = new Date(dayObj.date);
      const key = d.getMonth() + '-' + d.getDate();
      if (dayObj.isLeave) {
        leaveSet.add(key);
      } else {
        tripSet.add(key);
      }
    });
  });

  document.getElementById('calGrid').innerHTML = months.map((m, mi) => {
    const daysInMonth = new Date(year, mi + 1, 0).getDate();
    const dots = [];
    for (let d = 1; d <= daysInMonth; d++) {
      const key = mi + '-' + d;
      let cls = '';
      if (leaveSet.has(key)) cls = 'leave';
      else if (tripSet.has(key)) cls = 'trip';
      else if (holidaySet.has(key)) cls = 'holiday';
      dots.push('<div class="cal-dot ' + cls + '" title="' + m + ' ' + d + '"></div>');
    }
    return '<div class="cal-month"><div class="cal-month-name">' + m + '</div><div class="cal-dots">' + dots.join('') + '</div></div>';
  }).join('');
}


// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// TOAST
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showToast(msg) {
  const t = document.createElement('div');
  t.className = 'toast';
  t.textContent = msg;
  document.body.appendChild(t);
  setTimeout(() => t.remove(), 3000);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// INIT
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Restore state if already set up
if (state.homeCity && state.holidays.length && state.destinations.length && state.trips.length) {
  document.getElementById('landing').classList.add('hidden');
  document.getElementById('app').classList.remove('hidden');
  renderResults();
  showSection('results');
}

// All init runs after DOM is fully ready
document.addEventListener('DOMContentLoaded', () => {
  try {
    // Restore saved state
    if (state.homeCity) selectCity(state.homeCity, state.homeCityCode);
    if (state.holidays.length) renderHolidayTags();
    if (state.destinations.length) renderSelectedDests();

    // Auto-go to results if full state exists
    if (state.homeCity && state.holidays.length && state.destinations.length && state.trips.length) {
      document.getElementById('landing').classList.add('hidden');
      document.getElementById('app').classList.remove('hidden');
      renderResults();
      showSection('results');
    }
  } catch(e) {
    console.warn('State restore error, clearing:', e);
    localStorage.removeItem('holidayiq_state');
  }

  // Dragover styling
  const zone = document.getElementById('uploadZone');
  if (zone) {
    zone.addEventListener('dragover', () => zone.classList.add('dragover'));
    zone.addEventListener('dragleave', () => zone.classList.remove('dragover'));
    zone.addEventListener('drop', () => zone.classList.remove('dragover'));
  }

  // Init destination dropdown
  try { showDestDropdown(); } catch(e) {}
});
</script>

</body>
</html>
